<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Schema;

class PublicChem50Seeder extends Seeder
{
    public function run(): void
    {
        $examTitle = 'Đề thi thử THPT Môn Hóa học - 50 Câu';
        $questionsJson = <<<'QJSON'
[ {"id":1,"topic":"Este - Lipit","question":"Este X có công thức phân tử $C_4H_8O_2$. Khi thủy phân X trong môi trường axit thu được ancol etylic. Tên gọi của X là:","options":{"A":"Etyl axetat","B":"Metyl propionat","C":"Propyl axetat","D":"Isopropyl fomat"},"answer":"A"},{"id":2,"topic":"Kim loại kiềm","question":"Kim loại nào sau đây có tính khử mạnh nhất?","options":{"A":"Na","B":"K","C":"Li","D":"Cs"},"answer":"D"},{"id":3,"topic":"Polime","question":"Polime nào sau đây được điều chế bằng phản ứng trùng ngưng?","options":{"A":"Poli(vinyl clorua)","B":"Polietilen","C":"Nilon-6,6","D":"Polisopren"},"answer":"C"},{"id":4,"topic":"Đại cương kim loại","question":"Dãy các kim loại nào sau đây được sắp xếp theo chiều tăng dần của tính khử?","options":{"A":"Al, Mg, Ca, K","B":"K, Ca, Mg, Al","C":"Al, Ca, Mg, K","D":"Mg, K, Ca, Al"},"answer":"A"},{"id":5,"topic":"Axit cacboxylic","question":"Dung dịch axit axetic phản ứng được với tất cả các chất trong dãy nào sau đây?","options":{"A":"NaOH, Cu, $NaHCO_3$","B":"Na, $CaCO_3$, CuO","C":"NaCl, $C_2H_5OH$, Zn","D":"Ag, $H_2SO_4$, Mg"},"answer":"B"},{"id":6,"topic":"Sắt và hợp chất","question":"Trong công nghiệp, gang được sản xuất trong lò nào?","options":{"A":"Lò cao","B":"Lò bằng","C":"Lò điện","D":"Lò quay"},"answer":"A"},{"id":7,"topic":"Cacbohidrat","question":"Chất nào sau đây không tham gia phản ứng thủy phân?","options":{"A":"Saccarozơ","B":"Tinh bột","C":"Xenlulozơ","D":"Glucozơ"},"answer":"D"},{"id":8,"topic":"Điện phân","question":"Điện phân dung dịch $CuCl_2$ với điện cực trơ. Tại catot xảy ra quá trình nào?","options":{"A":"Khử ion $Cu^{2+}$","B":"Oxi hóa ion $Cu^{2+}$","C":"Khử ion $Cl^-$","D":"Oxi hóa ion $Cl^-$"},"answer":"A"},{"id":9,"topic":"Amin","question":"Chất nào sau đây có lực bazơ mạnh nhất?","options":{"A":"Anilin ($C_6H_5NH_2$)","B":"Metylamin ($CH_3NH_2$)","C":"Amoniac ($NH_3$)","D":"Đimetylamin ($(CH_3)_2NH$)"},"answer":"D"},{"id":10,"topic":"Nhôm và hợp chất","question":"Chất nào sau đây có tính lưỡng tính?","options":{"A":"$AlCl_3$","B":"$Al_2(SO_4)_3$","C":"$Al(OH)_3$","D":"$NaAlO_2$"},"answer":"C"},{"id":11,"topic":"Bài toán Este","question":"Đốt cháy hoàn toàn 7.4 gam este X no, đơn chức, mạch hở thu được 6.72 lít $CO_2$ (đktc). Công thức phân tử của X là:","options":{"A":"$C_2H_4O_2$","B":"$C_3H_6O_2$","C":"$C_4H_8O_2$","D":"$C_5H_{10}O_2$"},"answer":"B"},{"id":12,"topic":"Ăn mòn kim loại","question":"Để một vật bằng gang (hợp kim Fe-C) trong không khí ẩm, xảy ra quá trình ăn mòn điện hóa. Tại cực âm (anot) xảy ra quá trình nào?","options":{"A":"Sắt bị oxi hóa","B":"Oxi bị khử","C":"Cacbon bị oxi hóa","D":"Ion $H^+$ bị khử"},"answer":"A"},{"id":13,"topic":"Aminoaxit","question":"Dung dịch chất nào sau đây làm quỳ tím chuyển sang màu xanh?","options":{"A":"Glyxin","B":"Alanin","C":"Lysin","D":"Axit glutamic"},"answer":"C"},{"id":14,"topic":"Kim loại kiềm thổ","question":"Nước cứng tạm thời chứa các ion nào sau đây?","options":{"A":"$Ca^{2+}, Mg^{2+}, HCO_3^-$","B":"$Ca^{2+}, Mg^{2+}, Cl^-, SO_4^{2-}$","C":"$Na^+, K^+, HCO_3^-$","D":"$Ca^{2+}, Mg^{2+}, OH^-$"},"answer":"A"},{"id":15,"topic":"Tổng hợp vô cơ","question":"Khí X được tạo ra khi cho dung dịch HCl tác dụng với $FeS$. Khí X là:","options":{"A":"$H_2S$","B":"$SO_2$","C":"$Cl_2$","D":"$H_2$"},"answer":"A"},{"id":16,"topic":"Ancol","question":"Đun nóng etanol với $H_2SO_4$ đặc ở $170^oC$ thu được sản phẩm chính là:","options":{"A":"Eten","B":"Đietyl ete","C":"Metan","D":"Axetilen"},"answer":"A"},{"id":17,"topic":"Bài toán kim loại","question":"Hòa tan hoàn toàn 2.4 gam Mg vào dung dịch HCl dư, thu được V lít khí $H_2$ (đktc). Giá trị của V là:","options":{"A":"2.24","B":"4.48","C":"1.12","D":"3.36"},"answer":"A"},{"id":18,"topic":"Peptit - Protein","question":"Chất nào sau đây có phản ứng màu biure?","options":{"A":"Alanin","B":"Gly-Ala","C":"Lòng trắng trứng","D":"Metylamin"},"answer":"C"},{"id":19,"topic":"Crom và hợp chất","question":"Hợp chất nào của crom có màu da cam?","options":{"A":"$K_2CrO_4$","B":"$K_2Cr_2O_7$","C":"$Cr_2O_3$","D":"$Cr(OH)_3$"},"answer":"B"},{"id":20,"topic":"Phenol","question":"Phenol ($C_6H_5OH$) không phản ứng với chất nào sau đây?","options":{"A":"Dung dịch NaOH","B":"Kim loại Na","C":"Dung dịch $Br_2$","D":"Dung dịch $NaHCO_3$"},"answer":"D"},{"id":21,"topic":"Tổng hợp hữu cơ","question":"Công thức chung của ankan là:","options":{"A":"$C_nH_{2n+2}$ (n≥1)","B":"$C_nH_{2n}$ (n≥2)","C":"$C_nH_{2n-2}$ (n≥2)","D":"$C_nH_{2n-6}$ (n≥6)"},"answer":"A"},{"id":22,"topic":"Bài toán $CO_2$","question":"Sục từ từ 3.36 lít khí $CO_2$ (đktc) vào 200 ml dung dịch $Ca(OH)_2$ 1M. Khối lượng kết tủa thu được là:","options":{"A":"10 gam","B":"15 gam","C":"20 gam","D":"5 gam"},"answer":"A"},{"id":23,"topic":"Andehit - Xeton","question":"Chất nào sau đây tham gia phản ứng tráng bạc?","options":{"A":"Axeton","B":"Anđehit fomic","C":"Ancol etylic","D":"Axit axetic"},"answer":"B"},{"id":24,"topic":"Hóa học môi trường","question":"Khí nào sau đây là nguyên nhân chính gây ra hiệu ứng nhà kính?","options":{"A":"$O_2$","B":"$N_2$","C":"$CO_2$","D":"$H_2$"},"answer":"C"},{"id":25,"topic":"Bài toán sắt","question":"Cho 11.2 gam Fe tác dụng hết với dung dịch $H_2SO_4$ loãng dư, thu được dung dịch X. Cô cạn dung dịch X thu được bao nhiêu gam muối khan?","options":{"A":"30.4","B":"40.0","C":"28.4","D":"38.0"},"answer":"A"},{"id":26,"topic":"Este - Lipit","question":"Chất béo là trieste của axit béo với:","options":{"A":"Etanol","B":"Glixerol","C":"Metanol","D":"Phenol"},"answer":"B"},{"id":27,"topic":"Polime","question":"Tơ nào sau đây thuộc loại tơ tổng hợp?","options":{"A":"Tơ tằm","B":"Bông","C":"Tơ visco","D":"Tơ capron"},"answer":"D"},{"id":28,"topic":"Đại cương kim loại","question":"Nguyên tắc chung để điều chế kim loại là:","options":{"A":"Oxi hóa ion kim loại","B":"Khử ion kim loại","C":"Điện phân hợp chất kim loại","D":"Thủy luyện hợp chất kim loại"},"answer":"B"},{"id":29,"topic":"Amin","question":"Anilin ($C_6H_5NH_2$) tác dụng với dung dịch nào sau đây tạo kết tủa trắng?","options":{"A":"$HCl$","B":"$Br_2$","C":"$NaOH$","D":"$KMnO_4$"},"answer":"B"},{"id":30,"topic":"Sắt và hợp chất","question":"Công thức của quặng hematit đỏ là:","options":{"A":"$Fe_2O_3$","B":"$Fe_3O_4$","C":"$FeCO_3$","D":"$FeS_2$"},"answer":"A"},{"id":31,"topic":"Cacbohidrat","question":"Trong điều kiện thường, chất nào sau đây là chất rắn, dạng sợi, màu trắng?","options":{"A":"Glucozơ","B":"Saccarozơ","C":"Fructozơ","D":"Xenlulozơ"},"answer":"D"},{"id":32,"topic":"Bài toán nhôm","question":"Cho m gam Al phản ứng hoàn toàn với dung dịch $HNO_3$ loãng, dư thu được 0.672 lít khí $N_2O$ (đktc, sản phẩm khử duy nhất). Giá trị của m là:","options":{"A":"2.16","B":"4.32","C":"1.08","D":"3.24"},"answer":"A"},{"id":33,"topic":"Điện hóa","question":"Pin điện hóa Zn-Cu hoạt động, nồng độ của ion $Cu^{2+}$ trong dung dịch:","options":{"A":"Tăng","B":"Giảm","C":"Không đổi","D":"Tăng rồi giảm"},"answer":"B"},{"id":34,"topic":"Axit cacboxylic","question":"Axit fomic có trong nọc kiến. Khi bị kiến đốt, nên bôi chất nào sau đây vào vết thương để giảm sưng tấy?","options":{"A":"Giấm ăn","B":"Vôi tôi","C":"Muối ăn","D":"Cồn"},"answer":"B"},{"id":35,"topic":"Tổng hợp vô cơ","question":"Phản ứng hóa học nào sau đây không đúng?","options":{"A":"$Fe + 2HCl \\rightarrow FeCl_2 + H_2$","B":"$Cu + 2FeCl_3 \\rightarrow CuCl_2 + 2FeCl_2$","C":"$2Fe + 3Cl_2 \\xrightarrow{t^o} 2FeCl_3$","D":"$Fe + CuSO_4 \\rightarrow FeSO_4 + Cu$"},"answer":"B"},{"id":36,"topic":"Bài toán aminoaxit","question":"Cho 7.5 gam glyxin ($H_2NCH_2COOH$) tác dụng hết với dung dịch HCl dư. Khối lượng muối thu được là:","options":{"A":"11.15 gam","B":"12.55 gam","C":"10.15 gam","D":"13.25 gam"},"answer":"A"},{"id":37,"topic":"Kim loại kiềm thổ","question":"Chất được dùng để bó bột khi xương bị gãy là:","options":{"A":"Thạch cao nung ($CaSO_4 \\cdot H_2O$)","B":"Thạch cao sống ($CaSO_4 \\cdot 2H_2O$)","C":"Đá vôi ($CaCO_3$)","D":"Vôi sống (CaO)"},"answer":"A"},{"id":38,"topic":"Tổng hợp hữu cơ","question":"Chất X có công thức $CH_3COOCH_3$. Tên gọi của X là:","options":{"A":"Metyl axetat","B":"Etyl axetat","C":"Metyl fomat","D":"Propyl axetat"},"answer":"A"},{"id":39,"topic":"Điện phân","question":"Điện phân nóng chảy $Al_2O_3$ với anot bằng than chì. Khí sinh ra ở anot là:","options":{"A":"$O_2, CO, CO_2$","B":"Chỉ có $O_2$","C":"Chỉ có $CO_2$","D":"Chỉ có Al"},"answer":"A"},{"id":40,"topic":"Bài toán hỗn hợp kim loại","question":"Hòa tan hoàn toàn hỗn hợp gồm 6.5 gam Zn và 5.6 gam Fe trong dung dịch HCl dư, thu được V lít khí $H_2$ (đktc). Giá trị của V là:","options":{"A":"4.48","B":"2.24","C":"6.72","D":"8.96"},"answer":"A"},{"id":41,"topic":"Peptit - Protein","question":"Thủy phân hoàn toàn 1 mol pentapeptit X thu được 3 mol Gly, 1 mol Ala và 1 mol Val. Số công thức cấu tạo phù hợp của X là:","options":{"A":"20","B":"10","C":"15","D":"5"},"answer":"A"},{"id":42,"topic":"Ancol","question":"Glixerol có công thức là:","options":{"A":"$C_3H_5(OH)_3$","B":"$C_2H_4(OH)_2$","C":"$C_2H_5OH$","D":"$CH_3OH$"},"answer":"A"},{"id":43,"topic":"Đại cương kim loại","question":"Kim loại nào sau đây dẻo nhất?","options":{"A":"Vàng (Au)","B":"Bạc (Ag)","C":"Đồng (Cu)","D":"Nhôm (Al)"},"answer":"A"},{"id":44,"topic":"Bài toán bảo toàn electron","question":"Hòa tan hoàn toàn m gam Al trong dung dịch $HNO_3$ dư, thu được 4.48 lít (đktc) hỗn hợp khí NO và $N_2O$ có tỉ khối so với $H_2$ là 16.5. Giá trị của m là:","options":{"A":"13.5","B":"8.1","C":"10.8","D":"5.4"},"answer":"C"},{"id":45,"topic":"Cacbohidrat","question":"Để chứng minh trong phân tử glucozơ có nhiều nhóm hiđroxyl (OH), người ta cho dung dịch glucozơ phản ứng với:","options":{"A":"$Cu(OH)_2$ ở nhiệt độ thường","B":"Dung dịch $AgNO_3/NH_3$","C":"Kim loại Na","D":"Anhiđrit axetic"},"answer":"A"},{"id":46","topic":"Sắt và hợp chất","question":"Cho dung dịch $FeCl_3$ tác dụng với dung dịch NaOH dư, thu được kết tủa X. Nung X trong không khí đến khối lượng không đổi thu được chất rắn Y. Y là:","options":{"A":"$Fe_2O_3$","B":"$FeO$","C":"$Fe_3O_4$","D":"Fe"},"answer":"A"},{"id":47,"topic":"Polime","question":"Cao su buna-S là sản phẩm đồng trùng hợp của buta-1,3-đien với:","options":{"A":"Stiren","B":"Lưu huỳnh","C":"Acrylonitrin","D":"Vinyl clorua"},"answer":"A"},{"id":48,"topic":"Bài toán este nâng cao","question":"Xà phòng hóa hoàn toàn 17.24 gam chất béo cần vừa đủ 0.06 mol NaOH. Cô cạn dung dịch sau phản ứng thu được khối lượng xà phòng là:","options":{"A":"17.80 gam","B":"18.24 gam","C":"16.68 gam","D":"18.38 gam"},"answer":"A"},{"id":49,"topic":"Kim loại kiềm","question":"Sản phẩm của phản ứng khi cho Na tác dụng với $H_2O$ là:","options":{"A":"NaOH và $H_2$","B":"$Na_2O$ và $H_2$","C":"$Na_2O_2$ và $H_2O$","D":"NaOH và $O_2$"},"answer":"A"},{"id":50,"topic":"Amin","question":"Để phân biệt anilin, phenol và benzen, ta có thể dùng thuốc thử nào sau đây?","options":{"A":"Dung dịch $Br_2$","B":"Dung dịch HCl","C":"Dung dịch NaOH","D":"Quỳ tím ẩm"},"answer":"A"} ]
QJSON;

        $questions = json_decode($questionsJson, true) ?: [];

        DB::transaction(function () use ($examTitle, $questions) {
            // Ensure subject and class exist
            DB::table('public_subjects')->updateOrInsert(['name' => 'Hóa Học'], ['name' => 'Hóa Học']);
            $subjectId = DB::table('public_subjects')->where('name', 'Hóa Học')->value('id');
            DB::table('public_classes')->updateOrInsert(['name' => 'Lớp 12'], ['name' => 'Lớp 12']);
            $classId = DB::table('public_classes')->where('name', 'Lớp 12')->value('id');

            $examId = DB::table('public_exams')->insertGetId([
                'title' => $examTitle ?? 'Đề Hóa học 50 câu',
                'description' => 'Đề trắc nghiệm 50 câu môn Hóa học (nhập thủ công).',
                'public_subject_id' => $subjectId,
                'public_class_id' => $classId,
                'duration_minutes' => 90,
                'created_at' => now(),
                'updated_at' => now(),
            ]);

            foreach ($questions as $q) {
                $content = trim((string)($q['question'] ?? ''));
                if (!empty($q['topic'])) {
                    $content = "[Chủ đề: {$q['topic']}]\n".$content;
                }
                $questionId = DB::table('public_questions')->insertGetId([
                    'public_exam_id' => $examId,
                    'content' => $content,
                    'created_at' => now(),
                    'updated_at' => now(),
                ]);
                $answer = strtoupper((string)($q['answer'] ?? ''));
                $options = $q['options'] ?? [];
                foreach (['A','B','C','D'] as $label) {
                    if (!array_key_exists($label, $options)) continue;
                    DB::table('public_choices')->insert([
                        'public_question_id' => $questionId,
                        'label' => $label,
                        'content' => (string)$options[$label],
                        'is_correct' => $label === $answer,
                        'created_at' => now(),
                        'updated_at' => now(),
                    ]);
                }
            }
        });
    }
}


